<!DOCTYPE html>
<html lang="en">
<head>
    <!-- (Previous head content remains the same) -->
</head>
<body>
    <!-- (Previous body content remains the same) -->

    <audio id="alertSound" src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3"></audio>

    <script>
        let timer;
        let minutes = 5;
        let seconds = 0;
        let isRunning = false;
        let isBreak = false;
        let remindersInterval;

        const timerDisplay = document.getElementById('timer');
        const statusDisplay = document.getElementById('status');
        const startPomodoroBtn = document.getElementById('startPomodoro');
        const startBreakBtn = document.getElementById('startBreak');
        const resetBtn = document.getElementById('reset');
        const startRemindersBtn = document.getElementById('startReminders');
        const alertSound = document.getElementById('alertSound');

        function startTimer(duration) {
            clearInterval(timer);
            minutes = duration;
            seconds = 0;
            isRunning = true;
            timer = setInterval(updateTimer, 1000);
            updateTimerDisplay();
        }

        function updateTimer() {
            if (minutes === 0 && seconds === 0) {
                clearInterval(timer);
                isRunning = false;
                if (isBreak) {
                    statusDisplay.textContent = "Break finished! Start a new Pomodoro.";
                    sendAlert("Break finished!", "Time to get back to work.");
                } else {
                    statusDisplay.textContent = "Pomodoro finished! Take a break.";
                    sendAlert("Pomodoro finished!", "Time for a break.");
                }
                return;
            }

            if (seconds === 0) {
                minutes--;
                seconds = 59;
            } else {
                seconds--;
            }
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function resetTimer() {
            clearInterval(timer);
            minutes = 5;
            seconds = 0;
            isRunning = false;
            isBreak = false;
            updateTimerDisplay();
            statusDisplay.textContent = "Ready to start";
        }

        function requestNotificationPermission() {
            Notification.requestPermission().then(function(result) {
                if (result === "granted") {
                    startReminders();
                }
            });
        }

        function startReminders() {
            clearInterval(remindersInterval);
            remindersInterval = setInterval(() => sendAlert("Time for a Break!", "Stand up, stretch, and look at something 20 feet away."), 39 * 60 * 1000);
            startRemindersBtn.innerHTML = '<i class="fas fa-bell-slash"></i> Reminders Active';
        }

        function sendAlert(title, body) {
            // Play sound
            alertSound.play();

            // Send notification
            if (Notification.permission === "granted") {
                const notification = new Notification(title, {
                    body: body,
                    icon: 'icon.png'
                });

                notification.onclick = function() {
                    window.focus();
                    this.close();
                };
            }

            // Alert in the browser
            alert(`${title}\n${body}`);
        }

        startPomodoroBtn.addEventListener('click', () => {
            startTimer(5);
            isBreak = false;
            statusDisplay.textContent = "Pomodoro in progress";
        });

        startBreakBtn.addEventListener('click', () => {
            startTimer(5);
            isBreak = true;
            statusDisplay.textContent = "Break in progress";
        });

        resetBtn.addEventListener('click', resetTimer);
        startRemindersBtn.addEventListener('click', requestNotificationPermission);

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js');
        }
    </script>
</body>
</html>